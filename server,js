const inquirer = require('inquirer');

// Import and require mysql2
const mysql = require('mysql2');

// Connect to database
const db = mysql.createConnection(
    {
      host: 'localhost',
      // MySQL username,
      user: 'root',
      // TODO: Add MySQL password here
      password: '',
      database: 'employeetrack_db'
    },
    console.log(`Connected to the employeetrack_db database.`)
);

connection.connect(function (err){
    if (err) throw err;
    firstPrompt();
})

//run the sart function
function firstPrompt(){
    inquirer.prompt([
        {
            type: 'list',
            name: 'userChoice',
            message; 'Waht would you like to do?',
            choices; [
                'View All Employees',
                'View Employees by Department', 
                'Add Employee',
                'Remove Employee',
                'Update Employee Role', 
                'Add Role', 
                'Add Department',
                'Exit'
            ]
        }
    
    ]).then((res) =>{
        console.log(res.userChoice);
        switch(res.userChoice){
            case 'View All Employee':
            viewAllEmployees();   
            break;
            
            case 'View Employees by Department':
                viewEmployeesByDepartment();
                break;

            case 'Add Employee':
                AddEmployee();
                break;

            case 'Remove Employee':
                RemoveEmployee();
                break;

            case 'Update Employee Role':
                updateEmployeeRole();
                break;

            case 'Add Role':
                addRole();
                break;

            case 'Add Department':
                addDepartment();
                break;
            
            case 'Exit':
                connection.end();
                break;
        }

    function viewAllEmployees(){
        let query = 
        `SELECT
            employee.id,
            employee.first_name,
            employee.last_name, 
            role.title, 
            department.name AS department, 
            role.salary, 
            CONCAT (manager.first_name, '', manager.last_name) AS manager
        FROM employee
        LEFT JOIN role
            ON employee.role_id = role.id
        LEFT JOIN department
            ON department.id = role.department_id
        LEFT JOIN employee manager
            ON manager.id = employee.manager_`
    
    connection.query (query, (err, res) => {
        if (err) throw err;
        console.table(res);
        firstPrompt
    });
    }

    })
}